---
downloads:
  - file: ../../src/assembly.mk
    title: Makefile
  - file: ../../envs/assembly.yml
    title: env.yml
---

(bf-assembly)=
# assembly.mk

## Overview

The `assembly.mk` workflow contains rules for performing _de novo_ and reference-based sequence assembly. Its entry point is the `bf-assemble` command.

:::{note} TODO
Rules for reference-based assembly is in progress.
:::

:::{hint} Environment Setup
:class: dropdown

Prior to using the workflow, download the dependencies within a virtual environment using your manager of choice:

```bash
bf-assemble init ENV_MANAGER=micromamba
```

Activate environment to expose dependencies:
```bash
micromamba activate bf-assembly
```
:::

## Rules

### assemble

Run a _de novo_ assembly pipeline using `spades` and `megahit`. Each tool is designated a directory under `assembly` to store all output.

**{sc}`Parameters`**

- READ_DIR: path to directory storing reads
- ASSEMBLER: specified tool for running the assembly (default: none)
- MIN_CONTIG_LEN: minimum contig length for screening contigs (default: 200)
- THREADS: number of cores (default: 8)
- PE: treat reads as pair-end (default: true)

**{sc}`Example Usage`**

Assemble pair-end reads into contigs using `megahit`
```bash
bf-assemble assemble READ_DIR=fastp/reads PE=true ASSEMBLER=megahit
```

Assemble pair-end reads into contigs using `spades`
```bash
bf-assemble assemble READ_DIR=fastp/reads PE=true ASSEMBLER=spades
```

Assemble single-end reads into contigs using `minia`
```bash
bf-assemble assemble READ_DIR=fastp/reads PE=true ASSEMBLER=minia
```

Generate contigs for all supported assemblers:
```bash
bf-assemble assemble READ_DIR=fastp/reads
```

### evaluate

Calculate assembly statistics to evaluate and compare assemblies.

This rule searches all directories under `assembly` to find the FASTA files containing the assembled contigs. Reports are stored in the default output directory of `quast` (quast_results).

**{sc}`Parameters`**

- ASSEMBLER: specified tool for running the assembly (default: none)
- PE: treat reads as pair-end (default: true)

**{sc}`Example Usage`**

Run `quast` on assembly generated by `megahit`.
```bash
bf-assemble evaluate ASSEMBLER=megahit PE=true
```

Run `quast` on assembly generated by `spades`.
```bash
bf-assemble evaluate ASSEMBLER=spades PE=true
```

Run `quast` on assembly generated by `minia`.
```bash
bf-assemble evaluate ASSEMBLER=minia PE=false
```

Run `quast` on all assemblies generated from pair-end reads. Assumes that the assembly file (FASTA) is located in the `assembly` directory.
```bash
bf-assemble evaluate PE=true
```

### visualize

Generate an image of the genome graph generated from the assembly using `Bandage`.

Produces images are saved in the `assembly/bandage` subdirectory.

**{sc}`Parameters`**

- ASSEMBLER: specified tool for running the assembly (default: none)

**{sc}`Example Usage`**

Visualize contigs generated by `megahit`.
```bash
bf-assemble visualize ASSEMBLER=megahit
```

Visualize contigs generated by `spades`.
```bash
bf-assemble visualize ASSEMBLER=spades
```

Visualize contigs from all assemblies.
```bash
bf-assemble visualize
```
