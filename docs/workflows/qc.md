---
downloads:
  - file: ../../src/qc.mk
    title: Makefile
  - file: ../../envs/qc.yml
    title: env.yml
---

(bf-qc)=
# qc.mk

## Overview

The `qc.mk` workflow contains rules for performing quality control on sequencing reads.

:::{hint} Environment Setup
:class: dropdown

Prior to using the workflow, download the dependencies within a virtual environment using your manager of choice:

```bash
make -f src/qc.mk init ENV_MANAGER=micromamba
```

Activate environment to expose dependencies:
```bash
micromamba activate bf-qc
```
:::

## Rules

### fastp

Perform automatic adapter trimming and quality score filtering.

Generates a set of trimmed/filtered reads and summary reports as output. These are stored in the `fastp/reads` and `fastp/reports` directories, respectively.

**{sc}`Parameters`**

- READ_DIR: path to directory storing reads
- MINLEN: minimum read length
- MAXLEN: maximum read length
- MINQUAL: minimum quality score threshold
- PE: treat reads as pair-end (default: true)

**{sc}`Example Usage`**
```bash
make -f src/qc.mk fastp READ_DIR=reads/
```

### fastqc

Generate a FASTQC report on selected reads.

FASTQ files are automatically discovered from the path specified by the `TARGET` parameter. If not given, the target defaults to the `READ_DIR` value. Reports are stored in the `output/fastqc/report#` directory where `#` is an auto-incrementing integer.

**{sc}`Parameters`**

- READ_DIR: path to directory storing reads
- TARGET: path storing the reads to be processed (default: READ_DIR)

**{sc}`Example Usage`**
Generate reports from trimmed reads outputted by `fastp`.
```bash
make -f src/qc.mk fastqc TARGET=fastp/reads
```

### multiqc

Aggregate FASTQC output into a single interactive report. 

By default, `mutliqc` aggregates the reports generated by the most recent run of `fastqc`. To aggregate all reports within the `fastqc` directory, set `TARGET` to `all`. Output is stored in a `output/multiqc/report#` directory where the report number matches the source FASTQC reports.

**{sc}`Example Usage`**
Compile all reports generated by the most recent run of `fastqc`.
```bash
make -f src/qc.mk multiqc
```

Compile all reports within the `fastqc` directory.
```bash
make -f src/qc.mk multiqc TARGET=all
```
